<!-- Load megamenu CSS -->
<link rel="stylesheet" type="text/css" href="catalog/view/theme/Plantz/stylesheet/ekokray/megamenu.css?v={{ "now"|date("U") }}" />

<div class="ekokray-megamenu" id="ekokray-megamenu-{{ menu_id }}" data-breakpoint="{{ mobile_breakpoint }}">

  <!-- Mobile Menu Toggle Button (hidden on desktop) -->
  <button class="ekokray-mobile-toggle" id="ekokray-mobile-toggle" aria-label="Toggle Menu">
    <span class="bar"></span>
    <span class="bar"></span>
    <span class="bar"></span>
  </button>

  <!-- Mobile Menu Overlay (hidden by default) -->
  <div class="ekokray-mobile-overlay" id="ekokray-mobile-overlay"></div>

  <!-- Menu Container -->
  <nav class="ekokray-menu-container">

    <!-- Mobile Menu Header (visible only on mobile, hidden on desktop) -->
    <div class="ekokray-mobile-header">
      <h3 class="ekokray-mobile-title">Меню</h3>
      <button class="ekokray-mobile-close" id="ekokray-mobile-close" aria-label="Close Menu">
        <i class="fa fa-times"></i>
      </button>
    </div>

    <!-- Mobile-only tools (search, account, cart) -->
    <div class="ekokray-mobile-tools">
      <!-- Mobile Search -->
      <div class="ekokray-mobile-search">
        <form action="index.php" method="get" class="ekokray-search-form">
          <input type="hidden" name="route" value="product/search" />
          <input type="text" name="search" placeholder="{{ text_search }}" class="ekokray-search-input" />
          <button type="submit" class="ekokray-search-btn">
            <i class="fa fa-search"></i>
          </button>
        </form>
      </div>

      <!-- Mobile Account & Cart -->
      <div class="ekokray-mobile-account-cart">
        <a href="{{ account_url }}" class="ekokray-mobile-account">
          <i class="fa fa-user"></i>
          <span>{% if logged %}{{ customer_name }}{% else %}{{ text_login }}{% endif %}</span>
        </a>
        <a href="{{ cart_url }}" class="ekokray-mobile-cart">
          <i class="fa fa-shopping-cart"></i>
          <span class="ekokray-cart-count" id="ekokray-cart-count">{{ cart_total }}</span>
        </a>
      </div>

      <!-- Mobile Account Menu -->
      <div class="ekokray-mobile-account-menu">
        {% if logged %}
          <a href="{{ account_url }}" class="ekokray-mobile-menu-link"><i class="fa fa-user"></i> {{ text_account }}</a>
          <a href="{{ logout_url }}" class="ekokray-mobile-menu-link"><i class="fa fa-sign-out"></i> {{ text_logout }}</a>
        {% else %}
          <a href="{{ login_url }}" class="ekokray-mobile-menu-link"><i class="fa fa-sign-in"></i> {{ text_login }}</a>
          <a href="{{ register_url }}" class="ekokray-mobile-menu-link"><i class="fa fa-user-plus"></i> {{ text_register }}</a>
        {% endif %}
        <a href="{{ checkout_url }}" class="ekokray-mobile-menu-link"><i class="fa fa-shopping-cart"></i> {{ text_checkout }}</a>
      </div>
    </div>

    <!-- Main Menu Items -->
    <ul class="ekokray-menu">
      {% for item in items %}
      <li class="ekokray-menu-item {% if item.children %}has-children{% endif %} {% if item.show_products %}has-products{% endif %}" data-item-id="{{ item.item_id }}">
        <a href="{{ item.href }}" target="{{ item.target }}" class="ekokray-menu-link">
          {{ item.title }}
          {% if item.children or item.subcategories %}
          <span class="ekokray-dropdown-toggle">
            <i class="fa fa-angle-down desktop-icon"></i>
            <i class="fa fa-angle-right mobile-icon"></i>
          </span>
          {% endif %}
        </a>

        {% if item.children or item.subcategories %}
        <!-- Dropdown Container -->
        <div class="ekokray-dropdown">
          <div class="ekokray-dropdown-inner">

            {% if item.subcategories %}
            <!-- Category Tree Layout - Simple text list -->
            <div class="ekokray-category-list">
              {% for subcategory in item.subcategories %}
              <div class="ekokray-category-item" data-category-id="{{ subcategory.category_id }}">
                <a href="{{ subcategory.href }}" class="ekokray-category-link">
                  <span class="ekokray-category-name">{{ subcategory.name }}</span>
                  <i class="fa fa-angle-right"></i>
                </a>
                <!-- Products will be loaded here on hover -->
                <div class="ekokray-category-products" data-category-id="{{ subcategory.category_id }}" data-limit="{{ item.product_limit|default(8) }}">
                  <div class="ekokray-products-loading">
                    <i class="fa fa-spinner fa-spin"></i> Завантаження...
                  </div>
                  <div class="ekokray-products-grid"></div>
                </div>
              </div>
              {% endfor %}
            </div>
            {% endif %}

            {% if item.children %}
            <!-- Child Items -->
            <ul class="ekokray-submenu">
              {% for child in item.children %}
              <li class="ekokray-submenu-item">
                <a href="{{ child.href }}" target="{{ child.target }}" class="ekokray-submenu-link">
                  {{ child.title }}
                </a>
              </li>
              {% endfor %}
            </ul>
            {% endif %}

            {% if item.show_products %}
            <!-- Products Container (loaded via AJAX) -->
            <div class="ekokray-products-container" data-category-id="{{ item.category_id }}" data-limit="{{ item.product_limit }}">
              <div class="ekokray-products-loading">
                <i class="fa fa-spinner fa-spin"></i> Завантаження...
              </div>
              <div class="ekokray-products-grid"></div>
            </div>
            {% endif %}

          </div>
        </div>
        {% endif %}
      </li>
      {% endfor %}
    </ul>

  </nav>
</div>

<!-- Hidden data for JavaScript -->
<script>
window.ekokrayMegamenuData = window.ekokrayMegamenuData || {};
window.ekokrayMegamenuData['menu_{{ menu_id }}'] = {
  menuId: {{ menu_id }},
  mobileBreakpoint: {{ mobile_breakpoint }},
  getProductsUrl: 'index.php?route=extension/module/ekokray_megamenu/getProducts'
};
</script>

<!-- Load megamenu JavaScript directly -->
<script type="text/javascript" src="catalog/view/javascript/ekokray/megamenu.js?v={{ "now"|date("U") }}"></script>
